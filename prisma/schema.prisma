// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}
// Định nghĩa model User (thay thế users table)
model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  email     String   @unique
  password  String?
  googleId  String?   @unique @map("google_id")
  authType  String    @default("local") @map("auth_type") // 'local', 'google'
  role      String   @default("user") // 'user', 'admin', 'moderator'
  status    String   @default("active") // 'active', 'inactive', 'banned'
  
  // Các field mới cho việc xác thực
  isVerified Boolean @default(false) @map("is_verified")
  
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  keyToken KeyToken?
  @@map("users") // Map với tên bảng 'users' trong DB
}
// Định nghĩa model OTP (thay thế otp table)
model Otp {
  id          Int      @id @default(autoincrement())
  email       String
  otpCode     String   @map("otp_code")
  otpType     String   @map("otp_type") // 'REGISTER', 'LOGIN', 'FORGOT_PASS'
  expiresAt   DateTime @map("expires_at")
  isUsed      Boolean  @default(false) @map("is_used")
  
  createdAt   DateTime @default(now()) @map("created_at")
  @@index([email, otpType]) // Đánh index như cũ
  @@map("otp")
}

model KeyToken {
  id Int @id @default(autoincrement())
  userId Int @unique
  refreshToken String
  
  user User @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


